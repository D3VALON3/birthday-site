<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy Birthday</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Abril+Fatface&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-dark:#0f1724;
    --bg-light:#f6f7fb;
    --card-dark:#0b1220;
    --card-light:#ffffff;
    --accent-lav:#b497ff;
    --muted-dark:#a9b3c2;
    --muted-light:#6b6b7a;
    --text-dark:#e6eef8;
    --text-light:#1b1b26;
  }

  body[data-theme="dark"]{
    --bg:var(--bg-dark);
    --card:var(--card-dark);
    --accent:var(--accent-lav);
    --muted:var(--muted-dark);
    --text:var(--text-dark);
  }
  body[data-theme="light"]{
    --bg:var(--bg-light);
    --card:var(--card-light);
    --accent:var(--accent-lav);
    --muted:var(--muted-light);
    --text:var(--text-light);
  }

  html,body{ height:100%; margin:0; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: radial-gradient(800px 600px at 90% 80%, rgba(180,150,255,0.06), transparent), var(--bg); color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }

  .container{ max-width:900px; margin:0 auto; height:100vh; display:flex; align-items:center; justify-content:center; padding:20px; box-sizing:border-box; }

  .page{ width:100%; height:100%; display:none; flex-direction:column; align-items:center; justify-content:center; text-align:center; position:relative; }
  .page.active{ display:flex; }

  .card{ width:100%; max-width:760px; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); border-radius:18px; padding:28px; box-sizing:border-box; box-shadow: 0 8px 30px rgba(2,6,23,0.08); border:1px solid rgba(0,0,0,0.06); background-color:var(--card); color:var(--text); }

  .countdown{ font-size:clamp(48px, 12vw, 96px); font-weight:800; letter-spacing:3px; margin:10px 0 16px; color:var(--accent); transition: opacity .6s ease, transform .6s ease; }
  .small{ font-size:clamp(14px,2.6vw,18px); color:var(--muted); margin-bottom:18px; }

  .btn{ display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 14px; border-radius:12px; background:linear-gradient(90deg,var(--accent), #c9a7ff); color:var(--text); font-weight:700; border:none; cursor:pointer; box-shadow: 0 6px 18px rgba(0,0,0,0.06); transform:translateY(0); }
  .btn.alt{ background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); }
  .btn:active{ transform:translateY(1px); }

  .popmsg{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; }
  .popcard{ background:transparent; padding:6px 8px; border-radius:16px; transform-origin:center; transform:scale(0.8); opacity:0; transition: transform .55s cubic-bezier(.2,.9,.3,1), opacity .45s; }
  .popcard.show{ transform:scale(1); opacity:1; pointer-events:auto; }

  .hb-wrap{ width:100%; display:flex; align-items:center; justify-content:center; }
  svg.hb{ width:100%; max-width:620px; height:auto; overflow:visible; }

  .confetti-piece{ position:absolute; width:10px; height:14px; will-change:transform, opacity; opacity:0.95; border-radius:2px; }

  .typewriter{ font-size:clamp(18px,4vw,22px); line-height:1.6; min-height:120px; white-space:pre-wrap; text-align:left; margin-bottom:18px; color:var(--text); }

  .controls{ display:flex; gap:12px; justify-content:center; margin-top:12px; }

  #birthdayVideo{ width:100%; max-height:56vh; border-radius:12px; background: #000; display:block; }

  .final{ display:flex; flex-direction:column; align-items:center; justify-content:center; gap:18px; }
  .big{ font-size:clamp(36px, 10vw, 96px); font-weight:900; line-height:0.9; letter-spacing:1px; }
  .sub{ font-size:clamp(16px,3.2vw,20px); color:var(--muted); }

  .sparkles{ position:absolute; inset:0; pointer-events:none; overflow:hidden; z-index:10; }
  .faller{ position:absolute; font-size:18px; opacity:0; transform:translateY(-10px) rotate(0deg); animation:fall linear infinite; }
  @keyframes fall{ 0%{ opacity:0; transform:translateY(-10vh) rotate(0deg);} 10%{ opacity:1;} 100%{ opacity:0; transform:translateY(110vh) rotate(360deg);} }

  @media (max-width:480px){ .card{ padding:18px; border-radius:14px; } .typewriter{ min-height:110px; } }

  .dots{ display:flex; gap:8px; justify-content:center; margin-top:12px; }
  .dot{ width:8px; height:8px; border-radius:99px; background:rgba(0,0,0,0.06); }
  .dot.active{ background:var(--accent); box-shadow:0 0 10px rgba(0,0,0,0.08); }

  @keyframes floatSway{ 0%{ transform:translateY(0); } 50%{ transform:translateY(-8px); } 100%{ transform:translateY(0); } }
  .hb-wrap{ animation: floatSway 3.6s ease-in-out infinite; }

  .grad1 stop:first-child{ stop-color:#fff8f6; }
  .grad1 stop:last-child{ stop-color:#ffd1d1; }

  .btn:focus{ outline:3px solid rgba(181,150,255,0.22); outline-offset:3px; }

  .video-controls{ display:flex; gap:10px; justify-content:center; margin-top:12px; align-items:center; }
  .theme-toggle{ position:fixed; top:14px; right:14px; z-index:60; backdrop-filter:blur(6px); padding:8px; border-radius:10px; }

</style>
</head>

<!-- embedded YouTube ID added here so the page will use it automatically -->
<body data-theme="dark" data-youtube-id="vwgugj2TZ-8">
<button class="theme-toggle btn alt" id="themeToggle" title="Toggle theme">Toggle theme</button>

<div class="container">
  <!-- Page 1: Countdown -->
  <section id="page1" class="page active" aria-label="Countdown">
    <div class="card">
      <div class="small">A little surprise starts soon. Close your eyes if you want.</div>
      <div id="countdown" class="countdown">00:00:10</div>
      <div class="small" id="countHint">Get ready...</div>

      <div class="controls" style="justify-content:center;margin-top:12px">
        <button id="skipBtn" class="btn" style="background:rgba(255,255,255,0.06); color:var(--accent);">Skip</button>
      </div>

      <div class="popmsg" aria-hidden="true">
        <div id="popcard" class="popcard" role="status" aria-live="polite">
          <div class="hb-wrap" id="hbwrap" style="display:none">
            <svg class="hb" viewBox="0 0 1200 260" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Happy Birthday">
              <defs>
                <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1" class="grad1">
                  <stop offset="0%" stop-color="#f9f7ff" />
                  <stop offset="100%" stop-color="#cdb7ff" />
                </linearGradient>
                <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                  <feDropShadow dx="0" dy="10" stdDeviation="18" flood-color="#8a6cff" flood-opacity="0.12"/>
                </filter>
              </defs>

              <path id="arc" d="M60,180 A540,540 0 0,1 1140,180" fill="none" />

              <text font-family="'Abril Fatface', serif" font-weight="800" font-size="86" text-anchor="middle" fill="url(#g1)" filter="url(#shadow)">
                <textPath href="#arc" startOffset="50%" method="align" spacing="auto">HAPPY BIRTHDAY</textPath>
              </text>

              <text x="50%" y="210" font-family="Inter, sans-serif" font-size="28" text-anchor="middle" fill="var(--text)">
                üéâ May your year be full of love and laughter üéâ
              </text>
            </svg>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Page 2: Typewriter wish -->
  <section id="page2" class="page" aria-label="Wish">
    <div class="card">
      <div class="typewriter" id="typewriter"> </div>
      <div class="controls">
        <button id="nextFromType" class="btn">Next</button>
      </div>
      <div class="dots" style="margin-top:16px">
        <div class="dot"></div><div class="dot active"></div><div class="dot"></div>
      </div>
    </div>
  </section>

  <!-- Page 3: Video (YouTube preferred) -->
  <section id="page3" class="page" aria-label="Video">
    <div class="card">
      <div id="videoContainer">
        <!-- fallback local -->
        <video id="birthdayVideo" playsinline preload="metadata" autoplay muted loop controls>
          <source src="video.mp4" type="video/mp4">
          Your browser does not support the video tag. Place a file named "video.mp4" in the same folder as this HTML on GitHub, or the page will use the YouTube id embedded above.
        </video>
      </div>

      <div class="video-controls">
        <button id="soundBtn" class="btn">Unmute</button>
        <button id="nextFromVideo" class="btn">Next</button>
      </div>

      <div class="dots" style="margin-top:16px">
        <div class="dot"></div><div class="dot"></div><div class="dot active"></div>
      </div>
    </div>
  </section>

  <!-- Page 4: Final celebration -->
  <section id="page4" class="page" aria-label="Final">
    <div class="card final">
      <div class="big" id="finalText">HAPPY BIRTHDAY</div>
      <div class="sub">May your year be full of love, surprises and laughter.</div>
      <div style="display:flex;gap:12px">
        <button id="replay" class="btn" style="background:rgba(255,255,255,0.06); color:var(--accent)">Replay</button>
        <button id="downloadBtn" class="btn">Share (Save Folder)</button>
      </div>

      <div class="sparkles" id="sparkles"></div>
    </div>
  </section>
</div>

<script>
/* ---------- Utility / page navigation ---------- */
const pages = ['page1','page2','page3','page4'];
function showPage(id){ pages.forEach(p=>document.getElementById(p).classList.remove('active')); document.getElementById(id).classList.add('active'); window.scrollTo({top:0,left:0,behavior:'instant'}); }

/* ---------- theme toggle ---------- */
const themeToggle = document.getElementById('themeToggle');
function setTheme(t){ document.body.setAttribute('data-theme', t); localStorage.setItem('bday_theme', t); }
const saved = localStorage.getItem('bday_theme');
if(saved) setTheme(saved);
else{
  const prefers = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
  setTheme(prefers);
}
themeToggle.addEventListener('click', ()=>{ const cur = document.body.getAttribute('data-theme'); setTheme(cur==='dark'?'light':'dark'); });

/* ---------- Countdown logic ---------- */
const countdownEl = document.getElementById('countdown');
const popcard = document.getElementById('popcard');
const hbwrap = document.getElementById('hbwrap');
const countHint = document.getElementById('countHint');
let cancelled = false;

function startCountdown(from=10){
  const steps = from;
  const startI = 40; const endI = 420; const intervals = [];
  for(let i=0;i<=steps;i++){ const t = i/steps; const eased = Math.pow(t, 2); intervals.push(startI + (endI - startI) * eased); }
  let totalDelay = 0;
  for(let i=0;i<=steps;i++){
    const value = steps - i; totalDelay += intervals[i];
    setTimeout(((v)=>{ return ()=>{ if(cancelled) return; countdownEl.textContent = formatTime(v); if(v===0){ triggerConfetti(); revealHappyBirthday(); setTimeout(()=>{ countHint.textContent = ''; createNextButtonHint(); }, 520); } }; })(value), totalDelay);
  }
}
function formatTime(n){ return `00:00:${String(n).padStart(2,'0')}`; }

function revealHappyBirthday(){
  countdownEl.style.opacity = '0'; countdownEl.style.transform = 'scale(0.9)';
  setTimeout(()=>{ countdownEl.style.display = 'none'; countHint.style.display = 'none';
    hbwrap.style.display = 'flex'; popcard.classList.add('show');
  }, 650);
}

function createNextButtonHint(){ const controls = document.querySelector('#page1 .controls'); if(document.getElementById('nextBtn')) return; const btn = document.createElement('button'); btn.id='nextBtn'; btn.className='btn'; btn.textContent='Next'; btn.onclick = ()=> { popcard.classList.remove('show'); showPage('page2'); startTypewriter(); }; controls.appendChild(btn); }

/* ---------- Confetti ---------- */
function triggerConfetti(){ const total = 80; const colors = ['#b497ff','#ffd166','#6be5ff','#7ef5a1','#c084fc','#ff9cc2']; for(let i=0;i<total;i++){ const piece = document.createElement('div'); piece.className = 'confetti-piece'; piece.style.background = colors[Math.floor(Math.random()*colors.length)]; const container = document.querySelector('.container'); const w = container.clientWidth; const h = container.clientHeight; const startX = w/2 + (Math.random()-0.5)*100; const startY = h/2 + (Math.random()-0.5)*20; piece.style.left = (startX)+'px'; piece.style.top = (startY)+'px'; document.body.appendChild(piece); const angle = (Math.random()*Math.PI*2); const distance = 120 + Math.random()*260; const tx = Math.cos(angle)*distance; const ty = - (200 + Math.random()*260); const rot = (Math.random()*360); piece.animate([ { transform: `translate(0px,0px) rotate(0deg)`, opacity:1 }, { transform: `translate(${tx}px, ${ty}px) rotate(${rot}deg)`, opacity:0.1 } ],{ duration: 1000 + Math.random()*800, easing: 'cubic-bezier(.2,.8,.2,1)' }); setTimeout(()=> piece.remove(), 2400); } }

/* ---------- Typewriter ---------- */
const typewriterEl = document.getElementById('typewriter');
const dummyWish = `Hey Panda,

Today I want to tell you, without saying too much out loud, that you are my favorite part of every ordinary day. Your laugh, your silence, your tiny stubbornness ‚Äî it all adds up to something I never want to lose.

Wishing you the sweetest year yet.`;
let typingTimeouts = [];
function startTypewriter(){ typewriterEl.textContent = ''; typingTimeouts.forEach(t=>clearTimeout(t)); typingTimeouts = []; const chars = dummyWish.split(''); let time = 0; let speedBase = 28; chars.forEach((ch, i) => { const extra = (ch === ',' || ch === '-') ? 140 : (ch === '.' ? 300 : 0); time += speedBase + Math.floor(Math.random() * 30) + extra; const t = setTimeout(()=>{ typewriterEl.textContent += ch; typewriterEl.scrollTop = typewriterEl.scrollHeight; }, time); typingTimeouts.push(t); }); }

/* ---------- Sound control / YouTube support ---------- */
const videoElLocal = document.getElementById('birthdayVideo');
const soundBtn = document.getElementById('soundBtn');
let soundOn = false;
let ytPlayer = null;
let usingYouTube = false;

function getQueryParam(name){
  try{ const url = new URL(location.href); return url.searchParams.get(name); }catch(e){ return null; }
}
function extractYouTubeID(urlOrId){
  if(!urlOrId) return null;
  const ytRegex = /(?:youtube(?:-nocookie)?\\.com\\/(?:watch\\?v=|embed\\/|v\\/|.*[?&]v=)|youtu\\.be\\/)([\\w-]{11})/i;
  const m = urlOrId.match(ytRegex);
  if(m && m[1]) return m[1];
  if(urlOrId.length === 11) return urlOrId;
  return null;
}
function loadYouTubeAPI(callback){
  if(window.YT && window.YT.Player){ callback(); return; }
  const tag = document.createElement('script'); tag.src = "https://www.youtube.com/iframe_api"; document.head.appendChild(tag);
  window.onYouTubeIframeAPIReady = callback;
}
function initVideoSection(){
  const bodyYt = document.body.getAttribute('data-youtube-id');
  const queryYt = getQueryParam('yt');
  const ytId = extractYouTubeID(bodyYt) || extractYouTubeID(queryYt);
  if(ytId){
    usingYouTube = true;
    const container = document.getElementById('videoContainer');
    container.innerHTML = '<div id="ytPlayerHolder" style="width:100%;height:100%;max-height:56vh"></div>';
    loadYouTubeAPI(()=>{
      ytPlayer = new YT.Player('ytPlayerHolder', {
        height: '360', width: '640', videoId: ytId,
        playerVars: { autoplay: 1, playsinline: 1, mute: 1, loop: 1, playlist: ytId, controls: 1, modestbranding:1 },
        events: { onReady: (e)=>{ /* ready */ } }
      });
    });
  }
}
initVideoSection();

soundBtn.addEventListener('click', ()=>{
  if(usingYouTube){
    if(!ytPlayer) return;
    soundOn = !soundOn;
    if(soundOn) ytPlayer.unMute();
    else ytPlayer.mute();
    soundBtn.textContent = soundOn ? 'Mute' : 'Unmute';
  } else {
    if(!videoElLocal) return;
    soundOn = !soundOn;
    videoElLocal.muted = !soundOn;
    soundBtn.textContent = soundOn ? 'Mute' : 'Unmute';
  }
});

/* ---------- Decorative falling icons (hearts, sparkles, snowflakes, pandas) ---------- */
function spawnDecorativeFallers(){
  const container = document.getElementById('sparkles');
  const icons = ['‚ù§','‚ú®','‚ùÑ','üêº'];
  for(let i=0;i<18;i++){
    const el = document.createElement('div');
    el.className = 'faller';
    el.style.left = (Math.random()*100)+'%';
    el.style.fontSize = (12 + Math.random()*18)+'px';
    el.textContent = icons[Math.floor(Math.random()*icons.length)];
    el.style.animationDuration = (6 + Math.random()*6)+'s';
    el.style.animationDelay = (Math.random()*4)+'s';
    container.appendChild(el);
    el.addEventListener('animationend', ()=>{
      el.style.left = (Math.random()*100)+'%';
      el.style.fontSize = (12 + Math.random()*18)+'px';
      el.style.animationDuration = (6 + Math.random()*6)+'s';
      el.style.animationDelay = (Math.random()*4)+'s';
      void el.offsetWidth;
      el.style.animation = 'none';
      setTimeout(()=> el.style.animation = '' , 50);
    });
  }
}

/* ---------- Page controls ---------- */
document.getElementById('skipBtn').addEventListener('click', ()=>{ cancelled = true; countdownEl.textContent = '00:00:00'; triggerConfetti(); revealHappyBirthday(); createNextButtonHint(); });
document.getElementById('nextFromType').addEventListener('click', ()=>showPage('page3'));
document.getElementById('nextFromVideo').addEventListener('click', ()=>showPage('page4'));
document.getElementById('replay').addEventListener('click', ()=>{ cancelled = false; const nb = document.getElementById('nextBtn'); if(nb) nb.remove(); countdownEl.style.display = ''; countdownEl.style.opacity = '1'; countdownEl.style.transform = 'scale(1)'; countdownEl.textContent = '00:00:10'; countHint.textContent = 'Get ready...'; hbwrap.style.display = 'none'; popcard.classList.remove('show'); showPage('page1'); startCountdown(10); });
document.getElementById('downloadBtn').addEventListener('click', ()=>{ alert('To share: zip the folder containing birthday.html and your video (video.mp4), then send the zip. Or publish on GitHub Pages so the link is accessible.'); });

/* ---------- initialize ---------- */
startCountdown(10);
spawnDecorativeFallers();

</script>
</body>
</html>
